<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë°˜ë„ì²´ ëƒ‰ê° ê²Œì„</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .timer-wrapper {
      margin-bottom: 20px;
    }
    .timer {
      font-size: 26px;
      font-weight: bold;
      color: #fff;
      background-color: #333;
      padding: 10px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      text-align: center;
      letter-spacing: 1px;
      user-select: none;
      width: 90px;
    }
    .timer.urgent {
      background-color: #d32f2f !important;
      animation: blink 0.8s infinite;
    }
    @keyframes blink {
      0% { background-color: #d32f2f; }
      50% { background-color: #b71c1c; }
      100% { background-color: #d32f2f; }
    }
    .game-container {
      display: flex;
      gap: 30px;
      align-items: flex-start;
      margin-bottom: 30px;
    }
    .semiconductors {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 260px;
      min-height: 100px;
      border: 2px solid #999;
      border-radius: 10px;
      padding: 10px;
      background-color: #fff;
    }
    .semiconductor {
      width: 80px;
      height: 80px;
      border: 2px solid #555;
      border-radius: 8px;
      cursor: grab;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 20px;
      color: white;
      overflow: hidden;
      user-select: none;
    }
    .hot { background-color: red; }
    .normal { background-color: blue; }
    .cooling { background-color: orange !important; }
    .cooled { background-color: blue !important; }

    .cooler {
      width: 150px;
      height: 300px;
      background-color: #b3e5fc;
      border: 3px dashed #0288d1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 20px;
      text-align: center;
      position: relative;
      user-select: none;
    }
    .cooler.hovered { background-color: #81d4fa; }

    .power-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #777;
      color: white;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      cursor: pointer;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      transition: background-color 0.3s;
      user-select: none;
    }
    .power-button.on {
      background-color: #4caf50;
    }

    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 6px;
      width: 0%;
      background-color: limegreen;
      transition: width 0.1s linear;
    }
    .basket-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      user-select: none;
    }
    .basket-label {
      margin-bottom: 6px;
      font-weight: bold;
      font-size: 18px;
    }
    .basket {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 440px;
      min-height: 100px;
      border: 2px dashed #666;
      border-radius: 10px;
      padding: 10px;
      background-color: #f5f5f5;
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal {
      background-color: white;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      font-size: 20px;
      font-weight: bold;
      color: green;
      animation: popup 0.5s ease-out;
      max-width: 400px;
      user-select: none;
      white-space: pre-line;
    }
    .modal-title {
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .modal p {
      text-align: left;
      margin-bottom: 20px;
      line-height: 1.3;
    }
    .modal.fail { color: red; }
    #startOverlay button {
      display: block;
      margin: 0 auto;
      background-color: #0288d1;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
    }
    #startOverlay button:hover { background-color: #0277bd; }

    @keyframes popup {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    #blackoutModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      color: white;
      font-size: 36px;
      font-weight: bold;
      user-select: none;
      flex-direction: column;
      gap: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1> ë°˜ë„ì²´ ëƒ‰ê° ê²Œì„ </h1>
  <div class="timer-wrapper">
    <div class="timer" id="timer">00:30</div>
  </div>
  <div class="game-container">
    <div class="semiconductors" id="chipArea">
      <div class="semiconductor hot" draggable="true" id="chip1">ğŸ”¥</div>
      <div class="semiconductor normal" draggable="true" id="chip2">ğŸ˜</div>
      <div class="semiconductor hot" draggable="true" id="chip3">ğŸ”¥</div>
      <div class="semiconductor normal" draggable="true" id="chip4">ğŸ˜</div>
      <div class="semiconductor hot" draggable="true" id="chip5">ğŸ”¥</div>
      <div class="semiconductor normal" draggable="true" id="chip6">ğŸ˜</div>
    </div>
    <div class="cooler" id="cooler">
      <div class="power-button" id="powerButton" title="ì „ì› ì¼œê¸°/ë„ê¸°">â»</div>
      ì¿¨ëŸ¬
    </div>
  </div>
  <div class="basket-section">
    <div class="basket-label">ğŸ§º</div>
    <div class="basket" id="basket" ondragover="event.preventDefault()"></div>
  </div>

  <div class="modal-overlay" id="startOverlay" style="display: flex;">
    <div class="modal">
      <div class="modal-title">ğŸ”§ ê²Œì„ ì•ˆë‚´</div>
      <p>
        â€§ì¿¨ëŸ¬ì˜ ì „ì›ì„ ì¼œê³ , ë°œì—´ì´ ì‹¬í•œ ë°˜ë„ì²´ë¥¼<br>ì¿¨ëŸ¬ì— ë„£ì–´ ëƒ‰ê°ì‹œí‚¨ í›„, ğŸ§ºì— ë‹´ìœ¼ë©´ ì„±ê³µ<br>
        â€§ì œí•œ ì‹œê°„ <strong>30ì´ˆ</strong><br>
        â€§ë©€ì©¡í•œ ë°˜ë„ì²´ë¥¼ ì¿¨ëŸ¬ì— ë„£ìœ¼ë©´ ì‹œê°„ -3ì´ˆ<br>
        â€§ì •ì „ì´ ì ê¹ ë°œìƒí•  ìˆ˜ ìˆìŒ
      </p>
      <button id="startButton">START</button>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modalMessage">ğŸ‰ì„±ê³µ!</div>
  </div>

  <div id="blackoutModal">
    <div>âš¡ï¸ ì •ì „ ë°œìƒ âš¡ï¸</div>
    <div><span id="blackoutCountdown">3</span>ì´ˆ í›„ ë³µêµ¬</div>
  </div>

<script>
// (ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë„ˆë¬´ ê¸¸ì–´ì ¸ ì´ ëŒ“ê¸€ì— ë‹¤ ëª» ë‹´ê¸° ë•Œë¬¸ì— ì´ì–´ì„œ ì•„ë˜ì— ì´ì–´ì„œ ë³´ë‚´ë“œë¦´ê²Œìš”.)
</script>
</body>
</html>
<script>
  const chips = document.querySelectorAll('.semiconductor');
  const cooler = document.getElementById('cooler');
  const basket = document.getElementById('basket');
  const modalOverlay = document.getElementById('modalOverlay');
  const modalMessage = document.getElementById('modalMessage');
  const timerDisplay = document.getElementById('timer');
  const startOverlay = document.getElementById('startOverlay');
  const startButton = document.getElementById('startButton');
  const powerButton = document.getElementById('powerButton');
  const blackoutModal = document.getElementById('blackoutModal');
  const blackoutCountdown = document.getElementById('blackoutCountdown');

  let coolerOn = false;
  let totalHot = document.querySelectorAll('.hot').length;
  let cooledAndStored = 0;
  let gameEnded = false;
  let timeLeft = 30;
  let timerInterval = null;
  let blackoutTriggered = false;

  const coolingIntervals = {};

  powerButton.addEventListener('click', () => {
    coolerOn = !coolerOn;
    powerButton.classList.toggle('on', coolerOn);
    if (coolerOn) {
      for (const id in coolingIntervals) {
        if (!coolingIntervals[id].intervalId) {
          startCoolingInterval(id);
        }
      }
    } else {
      for (const id in coolingIntervals) {
        if (coolingIntervals[id].intervalId) {
          clearInterval(coolingIntervals[id].intervalId);
          coolingIntervals[id].intervalId = null;
        }
      }
    }
  });

  function formatTime(seconds) {
    const m = String(Math.floor(seconds / 60)).padStart(2, '0');
    const s = String(seconds % 60).padStart(2, '0');
    return `${m}:${s}`;
  }

  function startGame() {
    timerInterval = setInterval(() => {
      if (gameEnded) return clearInterval(timerInterval);
      timeLeft--;
      timerDisplay.textContent = formatTime(timeLeft);
      if (timeLeft <= 5) timerDisplay.classList.add("urgent");

      if (!blackoutTriggered && timeLeft <= 19 && timeLeft >= 13) {
        blackoutTriggered = true;
        triggerBlackout();
      }

      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        endGame(false);
      }
    }, 1000);
  }

  startButton.addEventListener('click', () => {
    startOverlay.style.display = 'none';
    timerDisplay.textContent = formatTime(timeLeft);
    startGame();
  });

  chips.forEach(chip => {
    chip.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', chip.id);
    });
  });

  cooler.addEventListener('dragover', (e) => {
    e.preventDefault();
    cooler.classList.add('hovered');
  });

  cooler.addEventListener('dragleave', () => {
    cooler.classList.remove('hovered');
  });

  cooler.addEventListener('drop', (e) => {
    e.preventDefault();
    cooler.classList.remove('hovered');
    if (gameEnded) return;

    const id = e.dataTransfer.getData('text/plain');
    const chip = document.getElementById(id);

    if (!coolerOn) {
      alert("âš ï¸ ì¿¨ëŸ¬ ì „ì›ì´ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤! ì „ì›ì„ ì¼œì£¼ì„¸ìš”.");
      return;
    }

    const currentChipsInCooler = cooler.querySelectorAll('.semiconductor.cooling').length;
    if (currentChipsInCooler >= 2) {
      alert("âš ï¸ ì¿¨ëŸ¬ì—ëŠ” í•œ ë²ˆì— ìµœëŒ€ 2ê°œì˜ ë°˜ë„ì²´ë§Œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
      return;
    }

    if (chip.classList.contains('cooling') || chip.classList.contains('cooled')) return;

    if (!chip.classList.contains('hot')) {
      alert("ğŸš« ì´ ë°˜ë„ì²´ëŠ” ì¿¨ë§í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤! (ì‹œê°„ -3ì´ˆ)");
      timeLeft = Math.max(0, timeLeft - 3);
      timerDisplay.textContent = formatTime(timeLeft);
      if (timeLeft === 0) endGame(false);
      return;
    }

    chip.classList.add('cooling');
    chip.classList.remove('hot');
    chip.innerHTML = '';
    chip.setAttribute('draggable', false);

    const bar = document.createElement('div');
    bar.classList.add('progress-bar');
    chip.appendChild(bar);
    cooler.appendChild(chip);

    const coolingTime = 3000 + Math.random() * 3000;
    const intervalTime = 50;
    const totalTicks = coolingTime / intervalTime;

    coolingIntervals[id] = {
      intervalId: null,
      progress: 0,
      totalTicks,
      bar,
      coolingTime
    };

    if (coolerOn) {
      startCoolingInterval(id);
    }
  });

  function startCoolingInterval(id) {
    const data = coolingIntervals[id];
    if (!data) return;

    data.intervalId = setInterval(() => {
      if (!coolerOn) return;
      data.progress++;
      const widthPercent = (data.progress / data.totalTicks) * 100;
      data.bar.style.width = `${widthPercent}%`;

      if (data.progress >= data.totalTicks) {
        clearInterval(data.intervalId);
        data.intervalId = null;

        const chip = document.getElementById(id);
        chip.classList.remove('cooling');
        chip.classList.add('cooled');
        chip.innerHTML = 'ğŸ˜‡';
        chip.appendChild(data.bar);
        chip.setAttribute('draggable', true);
        chip.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', chip.id);
        });
      }
    }, 50);
  }

  basket.addEventListener('drop', (e) => {
    e.preventDefault();
    if (gameEnded) return;

    const id = e.dataTransfer.getData('text/plain');
    const chip = document.getElementById(id);

    if (chip.classList.contains('cooled')) {
      cooledAndStored++;
      chip.classList.remove('cooled');
      basket.appendChild(chip);
      checkSuccess();
    }
  });

  function checkSuccess() {
    if (cooledAndStored === totalHot) endGame(true);
  }

  function endGame(success) {
    gameEnded = true;
    modalOverlay.style.display = 'flex';
    modalMessage.textContent = success ? "ğŸ‰ì„±ê³µ!" : "â°ì‹¤íŒ¨!(ì‹œê°„ ì´ˆê³¼)";
    modalMessage.className = success ? "modal" : "modal fail";
    clearInterval(timerInterval);

    coolerOn = false;
    powerButton.classList.remove('on');
    for (const id in coolingIntervals) {
      if (coolingIntervals[id].intervalId) {
        clearInterval(coolingIntervals[id].intervalId);
        coolingIntervals[id].intervalId = null;
      }
    }
  }

  function triggerBlackout() {
    if (gameEnded) return;

    const prevCoolerOn = coolerOn;

    blackoutModal.style.display = 'flex';
    document.body.style.backgroundColor = '#222';
    cooler.classList.add('blackout');

    coolerOn = false;
    powerButton.classList.remove('on');
    for (const id in coolingIntervals) {
      if (coolingIntervals[id].intervalId) {
        clearInterval(coolingIntervals[id].intervalId);
        coolingIntervals[id].intervalId = null;
      }
    }

    let count = 3;
    blackoutCountdown.textContent = count;
    const blackoutTimer = setInterval(() => {
      count--;
      blackoutCountdown.textContent = count;
      if (count <= 0) {
        clearInterval(blackoutTimer);
        blackoutModal.style.display = 'none';
        document.body.style.backgroundColor = '#f0f0f0';
        cooler.classList.remove('blackout');

        coolerOn = prevCoolerOn;
        powerButton.classList.toggle('on', coolerOn);

        if (coolerOn) {
          for (const id in coolingIntervals) {
            if (!coolingIntervals[id].intervalId) {
              startCoolingInterval(id);
            }
          }
        }
      }
    }, 1000);
  }
</script>
